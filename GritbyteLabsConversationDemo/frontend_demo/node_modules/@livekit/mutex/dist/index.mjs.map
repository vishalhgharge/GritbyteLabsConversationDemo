{"version":3,"file":"index.mjs","sources":["../src/index.ts"],"sourcesContent":["export class Mutex {\n  private _locking: Promise<void>;\n\n  private _locks: number;\n\n  constructor() {\n    this._locking = Promise.resolve();\n    this._locks = 0;\n  }\n\n  isLocked() {\n    return this._locks > 0;\n  }\n\n  lock() {\n    this._locks += 1;\n\n    let unlockNext: () => void;\n\n    const willLock = new Promise<void>(\n      (resolve) =>\n        (unlockNext = () => {\n          this._locks -= 1;\n          resolve();\n        }),\n    );\n\n    const willUnlock = this._locking.then(() => unlockNext);\n\n    this._locking = this._locking.then(() => willLock);\n\n    return willUnlock;\n  }\n}\n"],"names":["Mutex","__publicField","unlockNext","willLock","resolve","willUnlock"],"mappings":";;;AAAO,MAAMA,EAAM;AAAA,EAKjB,cAAc;AAJN,IAAAC,EAAA;AAEA,IAAAA,EAAA;AAGD,SAAA,WAAW,QAAQ,WACxB,KAAK,SAAS;AAAA,EAChB;AAAA,EAEA,WAAW;AACT,WAAO,KAAK,SAAS;AAAA,EACvB;AAAA,EAEA,OAAO;AACL,SAAK,UAAU;AAEX,QAAAC;AAEJ,UAAMC,IAAW,IAAI;AAAA,MACnB,CAACC,MACEF,IAAa,MAAM;AAClB,aAAK,UAAU,GACPE;MACV;AAAA,IAAA,GAGEC,IAAa,KAAK,SAAS,KAAK,MAAMH,CAAU;AAEtD,gBAAK,WAAW,KAAK,SAAS,KAAK,MAAMC,CAAQ,GAE1CE;AAAA,EACT;AACF;"}