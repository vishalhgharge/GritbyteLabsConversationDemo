{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["export class Mutex {\n  private _locking: Promise<void>;\n\n  private _locks: number;\n\n  constructor() {\n    this._locking = Promise.resolve();\n    this._locks = 0;\n  }\n\n  isLocked() {\n    return this._locks > 0;\n  }\n\n  lock() {\n    this._locks += 1;\n\n    let unlockNext: () => void;\n\n    const willLock = new Promise<void>(\n      (resolve) =>\n        (unlockNext = () => {\n          this._locks -= 1;\n          resolve();\n        }),\n    );\n\n    const willUnlock = this._locking.then(() => unlockNext);\n\n    this._locking = this._locking.then(() => willLock);\n\n    return willUnlock;\n  }\n}\n"],"names":["Mutex","__publicField","unlockNext","willLock","resolve","willUnlock"],"mappings":"oPAAO,MAAMA,CAAM,CAKjB,aAAc,CAJNC,EAAA,iBAEAA,EAAA,eAGD,KAAA,SAAW,QAAQ,UACxB,KAAK,OAAS,CAChB,CAEA,UAAW,CACT,OAAO,KAAK,OAAS,CACvB,CAEA,MAAO,CACL,KAAK,QAAU,EAEX,IAAAC,EAEJ,MAAMC,EAAW,IAAI,QAClBC,GACEF,EAAa,IAAM,CAClB,KAAK,QAAU,EACPE,GACV,CAAA,EAGEC,EAAa,KAAK,SAAS,KAAK,IAAMH,CAAU,EAEtD,YAAK,SAAW,KAAK,SAAS,KAAK,IAAMC,CAAQ,EAE1CE,CACT,CACF"}